## ccc: 請實作一個完整的 RSA 加解密系統

ChatGPT: https://chatgpt.com/c/674bda1a-3fe8-8012-991d-b709fbee7110

以下是一個簡單的 Python 程式，實作了一個完整的 RSA 加解密系統。這個系統包括了生成密鑰、加密、解密等功能。RSA 是一個非對稱加密系統，包含公鑰和私鑰。

### 步驟：
1. 生成兩個大質數 `p` 和 `q`。
2. 計算 `n = p * q`，這是公鑰和私鑰的一部分。
3. 計算 `phi(n) = (p - 1) * (q - 1)`，這是歐拉函數。
4. 選擇一個公鑰 `e`，其條件是 `1 < e < phi(n)` 且 `e` 和 `phi(n)` 互質。
5. 計算私鑰 `d`，使得 `d * e ≡ 1 (mod phi(n))`。
6. 使用公鑰進行加密，私鑰進行解密。

以下是 Python 實作：

```python
import random
from math import gcd

# 擴展歐幾里得算法
def extended_gcd(a, b):
    if b == 0:
        return a, 1, 0
    g, x1, y1 = extended_gcd(b, a % b)
    x = y1
    y = x1 - (a // b) * y1
    return g, x, y

# 生成 RSA 密鑰對
def generate_keypair(bits=1024):
    # 生成兩個大質數 p 和 q
    def is_prime(n):
        if n < 2:
            return False
        for i in range(2, int(n ** 0.5) + 1):
            if n % i == 0:
                return False
        return True
    
    def generate_large_prime(bits):
        while True:
            p = random.getrandbits(bits)
            if is_prime(p):
                return p

    p = generate_large_prime(bits // 2)
    q = generate_large_prime(bits // 2)
    
    while p == q:  # p 和 q 不能相同
        q = generate_large_prime(bits // 2)
    
    # 計算 n 和 phi(n)
    n = p * q
    phi_n = (p - 1) * (q - 1)

    # 選擇公鑰 e
    e = random.randint(2, phi_n - 1)
    while gcd(e, phi_n) != 1:  # e 和 phi(n) 必須互質
        e = random.randint(2, phi_n - 1)
    
    # 計算私鑰 d
    _, d, _ = extended_gcd(e, phi_n)
    d = d % phi_n  # 保證 d 是正數

    return (e, n), (d, n)

# 加密
def encrypt(plaintext, pubkey):
    e, n = pubkey
    ciphertext = [pow(ord(char), e, n) for char in plaintext]
    return ciphertext

# 解密
def decrypt(ciphertext, privkey):
    d, n = privkey
    plaintext = ''.join([chr(pow(char, d, n)) for char in ciphertext])
    return plaintext

# 範例使用
if __name__ == "__main__":
    # 生成公鑰和私鑰
    pubkey, privkey = generate_keypair(1024)
    
    # 顯示密鑰
    print("公鑰:", pubkey)
    print("私鑰:", privkey)
    
    # 原始訊息
    message = "Hello, RSA!"
    print("原始訊息:", message)
    
    # 加密訊息
    encrypted = encrypt(message, pubkey)
    print("加密後訊息:", encrypted)
    
    # 解密訊息
    decrypted = decrypt(encrypted, privkey)
    print("解密後訊息:", decrypted)
```

### 程式解釋：
1. `generate_keypair(bits)`：生成 RSA 密鑰對。首先生成兩個質數 `p` 和 `q`，然後計算 `n = p * q` 和 `phi(n)`。接著選擇公鑰 `e` 並使用擴展歐幾里得算法計算私鑰 `d`。
2. `encrypt(plaintext, pubkey)`：使用公鑰加密訊息。將每個字符轉換為數字，然後對每個字符執行 `pow(ord(char), e, n)` 來加密。
3. `decrypt(ciphertext, privkey)`：使用私鑰解密訊息。對每個加密的數字執行 `pow(char, d, n)` 來解密，並將其轉換回字符。

### 範例輸出：
```
公鑰: (65537, 154250258373870488872509659039607839156139460548551661210601546763047632097202288097702876267804574568964262405222703045908031942423973194198732354054026121086276266444277980698863950409090767713088170111313776257355235107011254597465423858350337507098059051781056702178036065868803274010254576014267859900699634404424301978144563502215918161476005930175847378800059348157243456625086146598692020283431245008627664071285086730736404696256780514033086489627887541362628803501459257406190350538128218187928818319496342734491317331628274245544079191084988682738273256181264264287617067847146881581009846372108957176846305010551409746385865322527746957671377764516473824049077624953234546029305286653405278540725411647185731983839290863102789893032155635080235887076073218460121209075292713836901597681383379566523563759356523212229153477609759453143195147146189342579343291350825780010664489722039460989417391539893471553510595390580556073970671905025273207304258039522535848442339219561395784950306519238979633268226015874325135053497945675156087243448202019424849853509494519241380779786012510648562779419180226928208129389135128825759241110582242708646482711100897184178695673036198828735137723412055498315950204874126835646312653595398627385562167344209206276481898440898462395429425824199015942855945248240267963103594453296898336121859372746771132260107992798531318240376077285529509479169898047370610502680329591417252695047556045538284062881351707564893838232944030416205448074573163625552117892127493159497113033343455739387774906202077647169840990348244417861212726479743116708018859848671496758226690116743849465798000084999307892772472508171189358056670949297425559704781053242064869101832321376141223417032011043037801617433436446519215988672866424984943421395788743465079559152975040732230197053662288443556373749748024090633688858019535206361736804798523079808271603838767745541579318408795822612803065369839515085348179179024741502023738617359606818899251542332833564707399420933883363137728145206240528287369303188222764541778073257509038184256191281370348246009835692204581464374208897247777137635428072890442207472441233042831021348763785970318570360207569466057212205389863389322400896224859523448018535536482464078993819763846462437398779394133036787868870045073509476774097519302261108553379089183032141644842442009536697633785796423232746399361438537238274586227206364824348890992964755874372281015039224118544171073557331899697011536215901440519727478753598195984031384571181063557126479098829244190242010388098881204218716451962102713337297276323072407408232118456226151338838919949142196052131855101276806810861048503631198982487902368380885160607689979388410103394406893601663124883052305859379962509925196332726123532084087509190723050432129975786870226459254093372215862395078904532438924585053518974453391258357
