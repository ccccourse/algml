### **10.2 對抗訓練的數學推導**

對抗訓練是生成對抗網絡（GAN）中的核心概念。其數學推導基於博弈論框架，其中生成器和判別器進行對抗學習。對抗訓練的目標是讓生成器生成的假數據足夠逼真，以至於判別器無法區分真實數據和生成數據。

#### **1. 基本設置：生成器和判別器**

- **生成器（Generator, G）**: 生成器的目的是從隨機噪聲（潛在變量 \( z \)）中生成與真實數據 \( \mathbf{x} \) 相似的假數據 \( G(z) \)。
- **判別器（Discriminator, D）**: 判別器的目的是區分真實數據和生成數據，輸出一個概率值 \( D(\mathbf{x}) \)，表示數據 \( \mathbf{x} \) 來自真實數據集的概率。

在這個背景下，生成器和判別器的目標是相反的，這就是所謂的對抗學習。

#### **2. GAN的損失函數**

GAN的訓練過程可以看作是一個博弈，生成器和判別器的目標互為對立。為了捕捉這種對抗性，我們需要對生成器和判別器分別定義損失函數。

##### **生成器的損失函數**

生成器的目標是“欺騙”判別器，使其認為生成的數據是真實的。對生成器來說，我們希望它最大化判別器錯誤識別的概率，這相當於最小化以下損失函數：

\[
\mathcal{L}_G = \mathbb{E}_{z \sim p_z(z)} \left[ \log (1 - D(G(z))) \right]
\]

這表示生成器希望生成的數據 \( G(z) \) 被判別器識別為真實數據的概率 \( D(G(z)) \) 越大越好。

##### **判別器的損失函數**

判別器的目標是區分真實數據 \( \mathbf{x_{real}} \) 和生成數據 \( G(z) \)，即最大化判別器對真實數據的識別能力，同時最小化它對假數據的誤識別。判別器的損失函數定義為：

\[
\mathcal{L}_D = \mathbb{E}_{\mathbf{x_{real}} \sim p_{\text{data}}(\mathbf{x})} \left[ \log D(\mathbf{x_{real}}) \right] + \mathbb{E}_{z \sim p_z(z)} \left[ \log (1 - D(G(z))) \right]
\]

其中：
- 第一項是判別器對真實數據的預測，目標是最大化 \( D(\mathbf{x_{real}}) \)，即讓判別器正確識別真實數據。
- 第二項是判別器對生成數據的預測，目標是最小化 \( D(G(z)) \)，即讓判別器能夠辨識出生成的數據是假的。

##### **損失函數的最小化問題**

總的來看，GAN的目標是通過對抗訓練來達到生成器和判別器之間的平衡。這可以看作是一個最小化-最大化問題，即：

\[
\min_G \max_D \mathcal{L}_{GAN}(D, G)
\]

這裡，生成器的目標是最小化它的損失函數（使生成的數據更真實），而判別器的目標是最大化它的損失函數（使它能夠準確地區分真實數據和生成數據）。

#### **3. GAN訓練的數學推導**

在博弈論中，這種最小化-最大化問題稱為**零和博弈**（Zero-Sum Game）。在這種博弈中，一方的收益正好是另一方的損失。最終目標是找到生成器和判別器的最佳參數，使得它們達到**納什均衡**（Nash Equilibrium），即：
- 生成器生成的數據無法被判別器區分，這時判別器無法區分真實數據和生成數據；
- 判別器無法再進行有效的區分，達到識別真實數據和生成數據的極限。

當GAN達到納什均衡時，生成器生成的數據與真實數據極為相似，並且判別器對這些數據的區分能力降到最低。

##### **對抗博弈的最優解**

如果GAN模型訓練充分，最終的最優解為：

\[
\mathcal{L}_G = \mathbb{E}_{z \sim p_z(z)} \left[ \log D(G(z)) \right]
\]

\[
\mathcal{L}_D = \mathbb{E}_{\mathbf{x_{real}} \sim p_{\text{data}}(\mathbf{x})} \left[ \log D(\mathbf{x_{real}}) \right] + \mathbb{E}_{z \sim p_z(z)} \left[ \log (1 - D(G(z))) \right]
\]

這意味著生成器希望最大化生成數據被判別器識別為真實數據的機會，而判別器則最大化其區分真實數據和生成數據的能力。

#### **4. 訓練過程中的數學變化**

在實際訓練中，生成器和判別器交替更新參數，最初生成器生成的數據與真實數據相差甚遠，因此判別器能夠輕鬆區分它們。隨著訓練的進行，生成器學會更好地模仿真實數據，而判別器的區分能力變得越來越精細。最終，這種交替更新的過程會使得兩者達到納什均衡。

---

### **總結**

對抗訓練的數學推導建立在生成器和判別器之間的零和博弈之上，最終達成生成器生成的數據無法區分與真實數據的理想目標。通過對抗損失函數的最小化-最大化優化問題，生成器和判別器不斷調整，進而實現數據的生成與判別之間的平衡。