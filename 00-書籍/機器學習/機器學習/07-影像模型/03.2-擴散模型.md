### 3.2 **擴散模型的數學模型**

擴散模型（Diffusion Models, DMs）是生成模型的一類，其基本理念來自於物理中的隨機過程，具體來說，它模擬的是一個正向的擴散過程和一個反向的去噪過程。通過這個過程，模型將噪聲逐步轉換為數據。這一模型在訓練過程中學習如何去噪，最終能夠從噪聲中生成高質量的數據。下面是擴散模型的數學表示。

#### 1. **正向過程（Forward Process）**

在正向過程中，從原始數據（例如圖像）開始，逐步添加噪聲直到數據變為純噪聲。這個過程可以通過一系列的馬可夫鏈來描述，其中每一步 \( t \) 都是將原始數據 \( x_0 \) 經過一個高斯噪聲擴散變換，得到 \( x_t \)。

對於每一個時間步 \( t \)，我們將噪聲添加到原始數據上，這樣每一個 \( x_t \) 都依賴於 \( x_{t-1} \)，且滿足以下條件：
\[
q(x_t | x_{t-1}) = \mathcal{N}(x_t; \sqrt{1 - \beta_t} x_{t-1}, \beta_t I)
\]
這裡，\( \beta_t \) 是控制每一步加入噪聲量的超參數，隨著時間步長的增加，噪聲量逐漸增大，最終在步驟 \( T \) 時達到純噪聲。

此外，正向過程還可以寫作：
\[
q(x_t | x_0) = \mathcal{N}(x_t; \sqrt{\bar{\alpha}_t} x_0, (1 - \bar{\alpha}_t) I)
\]
其中，\( \bar{\alpha}_t \) 是從 \( \alpha_t \)（\( \alpha_t = 1 - \beta_t \)）積累的參數，用來描述每個時間步的累積噪聲。

#### 2. **反向過程（Reverse Process）**

反向過程是生成模型的核心，即從純噪聲中恢復出數據。這一過程的目標是學習如何反向推進，將噪聲轉換為數據。反向過程的關鍵是學習條件概率 \( p_\theta(x_{t-1} | x_t) \)，這個條件概率描述了在給定當前噪聲樣本 \( x_t \) 的情況下，如何推算出上一時間步 \( x_{t-1} \) 的數據。

反向過程的公式通常表達為：
\[
p_\theta(x_{t-1} | x_t) = \mathcal{N}(x_{t-1}; \mu_\theta(x_t, t), \Sigma_t)
\]
其中，\( \mu_\theta(x_t, t) \) 是神經網絡的輸出，表示從噪聲樣本 \( x_t \) 和時間步 \( t \) 推算出 \( x_{t-1} \) 的均值；\( \Sigma_t \) 是反向過程中的協方差。

#### 3. **損失函數**

在訓練過程中，擴散模型的目標是最小化正向過程與反向過程之間的KL散度，或者說最小化反向過程的重構誤差。這個損失函數通常寫作：
\[
L_{\text{model}} = \mathbb{E}_{q(x_0, x_1, \dots, x_T)} \left[ \sum_{t=1}^T \text{KL}(q(x_{t-1}|x_t, x_0) || p_\theta(x_{t-1}|x_t)) \right]
\]
其中，\( \text{KL} \) 是Kullback-Leibler散度，用來衡量模型生成的分佈與真實數據分佈之間的差異。這個損失函數的最小化促使模型在每一個時間步的噪聲去除過程中學會更好的生成過程。

#### 4. **反向過程的近似**

由於正向過程中的噪聲添加是確定性的，而反向過程的噪聲去除是隨機的，因此，擴散模型的關鍵挑戰是如何設計有效的神經網絡模型來近似反向過程。通常，神經網絡被訓練來估計每一步反向過程中的去噪過程，通過最小化預測和真實值之間的差異來達成目標。

#### 5. **擴散模型的應用**

擴散模型已經在多個領域顯示了其強大的生成能力，尤其是在圖像生成領域。以下是一些常見的應用：

1. **圖像生成**：
   擴散模型可以生成高解析度且質量極高的圖像，尤其在像素級別的細節和多樣性方面表現優異。

2. **圖像修復與去噪**：
   擴散模型也可用於去噪和修復損壞的圖像，通過逆向的噪聲去除過程將模糊或損壞的圖像恢復為清晰的圖像。

3. **文本到圖像生成**：
   擴散模型在文本生成圖像方面也取得了顯著的成功，如DALL·E等模型利用擴散方法將文字描述轉換為相應的圖像。

4. **超分辨率**：
   擴散模型能夠對低解析度圖像進行超分辨率重建，將圖像解析度提高至更高的水平，同時保留原始圖像的細節。

#### 6. **總結**

擴散模型是一種革命性的生成模型，通過模擬從數據到噪聲再回到數據的過程，能夠生成高質量且細節豐富的數據。這些模型的訓練過程基於馬可夫鏈的推斷和去噪過程，並且在圖像生成、修復、超分辨率等領域取得了顯著的應用效果。隨著技術的進步，擴散模型在生成領域中的地位和應用範圍將繼續擴大。