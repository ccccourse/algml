3.3. 應對未測量的混淆因素

當我們面對未測量的混淆因素時，事情會變得更加複雜。例如，若Z1、Z2或Z3中的任何一個未被測量，是否可以估算式（20）中的公式並不立刻明確。經過幾步但具有挑戰性的代數運算後，可以揭示出，我們可以對Z2進行總和來得到：

```
P(y|do(x 0 )) =
```
### ∑

```
z 1 , z 3
```
```
P(z 1 )P(z 3 |z 1 )P(y|z 1 , z 3 , x 0 ) (23)
```

這意味著我們只需調整Z1和Z3，而無需測量Z2。一般而言，可以證明（Pearl, 2000a，第73頁），只要圖形是馬可夫的，則干預後的分佈P(Y=y|do(X=x))可以表示為以下公式：

```
P(Y=y|do(X=x)) =
```
### ∑

```
t
```
```
P(y|t, x)P(t) (24)
```
其中T是X的直接原因集合（也稱為“父母”）。這使得我們可以直接從圖形中寫出（23），從而跳過導致（23）的代數運算。它進一步暗示，無論模型多麼複雜，X的父母是估算X因果效應所需測量的唯一變數。然而，仍不立刻清楚的是，除了X的父母之外，是否有其他變數集合可以充分估算X的效應，是否某些代數操作可以進一步簡化式（23），或測量Z3（不像Z1或Z2）是否在任何P(y|do(x0))的估算中都是必要的。這些考慮可以通過接下來討論的圖形準則變得透明。

3.3.1. 協變量選擇—後門準則

考慮一個觀察性研究，其中我們希望找出X對Y的效應，例如治療對反應的影響，並假設對問題有關的因素如圖4所示進行結構化；其中一些影響反應，一些影響治療，還有一些同時影響治療和反應。這些因素中的某些可能是無法測量的，如基因特徵或生活方式，其他則是可測量的，如性別、年齡和薪資水平。我們的問題是選擇這些因素的一個子集進行測量和調整，即如果我們比較治療組與未治療組，並且這些選擇的因素值相同，我們會在該子群體中得到正確的治療效應。這樣的因素集合稱為“充分集合”或“可接受集合”。

圖4. 馬可夫模型示意後門準則。誤差項未明確顯示。

後門準則（Pearl, 1993a）通過提供一種圖形方法來選擇可接受的因素集合來解決這個問題。

定義3（可接受集合—後門準則）：如果滿足以下兩個條件，則集合S是可接受（或“充分”）的：

1. S中的元素不是X的後代
2. S中的元素“封鎖”了所有從X到Y的“後門”路徑，即所有以指向X的箭頭結束的路徑。

在這個準則中，“封鎖”按照定義1來解釋。例如，集合S={Z3}封鎖了路徑X←W1←Z1→Z3→Y，因為發射箭頭的節點Z3在S中。然而，集合S={Z3}並不封鎖路徑X←W1←Z1→Z3←Z2→W2→Y，因為發射箭頭的節點Z1和Z2都不在S中，而碰撞節點Z3也不在S外。

根據這個準則，我們可以看到，例如，集合{Z1, Z2, Z3}、{Z1, Z3}、{W1, Z3}和{W2, Z3}，每一個都是充分的調整集合，因為每個集合封鎖了X和Y之間的所有後門路徑。然而，集合{Z3}並不是充分的調整集合，因為如上所解釋，它沒有封鎖路徑X←W1←Z1→Z3←Z2→W2→Y。

後門準則的直覺如下。圖中的後門路徑攜帶了來自X到Y的虛假關聯，而沿著箭頭從X到Y的路徑則攜帶了因果關聯。通過對S進行條件化來封鎖前者路徑，確保了X和Y之間的測量關聯純粹是因果性的，即正確表示了目標量：X對Y的因果效應。排除X的後代（例如，W3或其任何後代）的原因可以參見（Pearl, 2009a，第338-341頁）。

總之，找到一個可接受集合S的含義是，對S進行分層可以保證去除相對於X對Y因果效應的所有混淆偏差。換句話說，在S的每一層中，風險差異給出了該層的正確因果效應。在二元情況下，例如，S層中的風險差異由以下公式給出：

```
P(Y=1|X=1, S=s)−P(Y=1|X=0, S=s)
```

而該層的X對Y的因果效應由以下公式給出：

```
P(Y=1|do(X=1), S=s)−P(Y=1|do(X=0), S=s)
```

這兩個表達式在S是充分集合時保證相等，例如{Z1, Z3}或{Z2, Z3}在圖4中的情況。同樣，所有層次的加權風險差異給出了整個群體中X對Y的正確因果效應。

```
P(Y=1|do(X=1))−P(Y=1|do(X=0))
```

對於多值變數X和Y，一個充分集合S使我們可以寫出：

```
P(Y=y|do(X=x), S=s) = P(Y=y|X=x, S=s)
```

並且：

```
P(Y=y|do(X=x)) = ∑ s P(Y=y|X=x, S=s)P(S=s) (25)
```

由於方程右側的所有因素都是可估算的（例如，通過回歸），因此也可以從這些數據中無偏地估算因果效應。

有趣的是，可以證明任何不可簡化的充分集合S作為單位，滿足流行病學家用來定義“混淆變數”的關聯準則。換句話說，S必須與X相關，並且同時在給定X的情況下與Y相關。這對S中的任何特定成員不必成立。例如，在圖4中的變數Z3，儘管它是每個充分集合的成員，因此是一個混淆變數，但它可以與Y和X都無關（Pearl, 2000a，第195頁）。相反，某些與Y和X都有關聯的預處理變數Z可能需要從充分集合中排除。

後門準則使我們能夠直接從圖形中選擇充分集合S，而無需操作截斷的因式分解公式。該選擇準則可以系統地應用於任何大小和形狀的圖形，從而使分析師不必判斷“在S的條件下X是否是條件可忽略的”，這是潛在反應框架中所需的艱巨心理任務（Rosenbaum和Rubin, 1983）。該準則還使分析師能夠尋找最佳的協變量集合，即一個最小化測量成本或抽樣變異性的集合（Tian等，1998）。總而言之，可以安全地說，有了後門準則，因果關係已經將“混淆”從其神秘和具爭議的概念庫中移除。