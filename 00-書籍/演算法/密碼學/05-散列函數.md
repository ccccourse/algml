**第 5 章 散列函數與數字簽章**

---

### **5.1 散列函數介紹**

**散列函數（Hash Function）** 是一種將任意長度的輸入映射為固定長度輸出的數學函數，輸出稱為 **散列值（Hash Value）** 或 **摘要（Digest）**。

#### **散列函數的特性**：
1. **輸出固定長度**：無論輸入長度為何，散列值的長度固定。
2. **高效計算**：對任意輸入，計算散列值的速度很快。
3. **唯一性**：不同的輸入應生成不同的散列值（碰撞少）。
4. **不可逆性**：由散列值難以還原原始輸入。
5. **微小改變大不同**：輸入的微小變化會導致完全不同的散列值。

#### **應用場景**：
- **數據完整性驗證**：檢查數據是否被篡改。
- **密碼存儲**：存儲用戶密碼的散列值，而非明文。
- **數字簽章**：作為簽章的一部分，提供數據摘要。
- **快速查找**：用於哈希表中的快速數據檢索。

---

### **5.2 常見散列算法：MD5、SHA**

#### **MD5（Message-Digest Algorithm 5）**
- 輸出長度：128 位（16 字節）。
- 優點：計算速度快，適用於完整性檢查。
- 缺點：存在碰撞漏洞，不適用於安全性需求高的應用。

#### **SHA（Secure Hash Algorithm）**
1. **SHA-1**：
   - 輸出長度：160 位（20 字節）。
   - 安全性：已不再建議使用，因為有實際碰撞攻擊。
   
2. **SHA-2**：
   - 包括 SHA-224、SHA-256、SHA-384 和 SHA-512。
   - 輸出長度範圍：224 到 512 位。
   - SHA-256 是當前應用最廣泛的安全散列算法之一。

3. **SHA-3**：
   - 基於 Keccak 算法設計，適用於高安全性需求。

---

### **5.3 數字簽章與驗證**

#### **數字簽章的概念**
數字簽章是一種基於非對稱加密的技術，用於驗證數據的完整性、發送者身份和不可否認性。

數字簽章的工作流程：
1. **簽章**：
   - 發送者對數據生成散列值。
   - 使用私鑰對散列值加密，生成數字簽章。
2. **驗證**：
   - 接收者使用發送者的公鑰解密簽章，獲取散列值。
   - 接收者重新計算數據的散列值，與解密得到的散列值比對。

#### **數字簽章的應用場景**：
- 電子郵件加密與簽章。
- 軟體分發的完整性驗證。
- 電子合同與數據的法律有效性確認。

---

### **5.4 使用 Python 實現數字簽章**

#### **使用 PyCryptodome 實現數字簽章**
以下是數字簽章的實現示例：

```python
from Crypto.Hash import SHA256
from Crypto.Signature import pkcs1_15
from Crypto.PublicKey import RSA

# 生成密鑰對
key = RSA.generate(2048)
private_key = key
public_key = key.publickey()

# 要簽名的數據
message = b"This is a secure message."

# 計算數據的散列值
hash_value = SHA256.new(message)

# 使用私鑰生成數字簽章
signature = pkcs1_15.new(private_key).sign(hash_value)

print(f"Signature: {signature.hex()}")

# 驗證數字簽章
try:
    pkcs1_15.new(public_key).verify(hash_value, signature)
    print("Signature is valid.")
except (ValueError, TypeError):
    print("Signature is invalid.")
```

---

### **5.5 散列碰撞問題**

#### **什麼是散列碰撞？**
散列碰撞指的是兩個不同的輸入產生相同的散列值，這種現象會降低散列函數的安全性。

#### **影響**：
1. 數據完整性：碰撞使得攻擊者可以通過構造具有相同散列值的偽造數據，繞過完整性檢查。
2. 數字簽章：利用碰撞構造欺詐性簽章。

#### **碰撞攻擊類型**：
1. **普通碰撞攻擊**：找到兩個不同的輸入，使其散列值相同。
2. **選擇前綴碰撞**：攻擊者預先指定兩個不同前綴，找到後續輸入使得它們的散列值相同。

#### **防範措施**：
1. 使用抗碰撞能力更強的散列算法，例如 SHA-256 或 SHA-3。
2. 增加輸入的隨機性，例如引入鹽值（Salt）。

---

**本章小結**：
- 理解了散列函數的基本概念及其應用。
- 探討了數字簽章的原理與實現方式。
- 使用 Python 實現了數據簽名與驗證流程。
- 認識到散列碰撞的威脅及其應對策略。

下一章將進一步討論密碼學中的關鍵技術，如密鑰交換協議與安全通訊協議的實現。